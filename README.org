#+TITLE: Metaflow-Flyte
#+AUTHOR: Jonathan Jin

Experiments in dispatching [[https://metaflow.org/][Metaflow]] flows to [[https://flyte.org/][Flyte]].

* Notes

** Extending Metaflow

   Metaflow has specific "extension points" built in. Any third-party package,
   such as ours, that conforms to their expected conventions and protocols will
   automatically get "injected" into `metaflow` top-level imports. This lets a
   package like ours define a custom decorator =FooDecorator= with name
   =@foo= and have it importable via:

   #+begin_src python
     from metaflow import foo
   #+end_src

   The same goes for CLI sub-commands, allowing us to define custom CLI trees
   such as =my_subcmd= and have them accessible from the typical =python
   my/metaflow/flow.py= command tree **with no user intervention**.

   Some more details here: [[https://github.com/Netflix/metaflow-extensions-template][Netflix/metaflow-extensions-template]].

* TODO [1/4] Tasks

** DONE Create a local Flyte cluster

   First, install [[https://docs.flyte.org/projects/flytectl/en/latest/gen/flytectl.html#flytectl][=flytectl=]]:

   #+begin_src bash
     brew install flyteorg/homebrew-tap/flytectl
   #+end_src

   #+begin_src bash
     flytectl sandbox start --source .
   #+end_src

** TODO [0/5] Submit flow to Flyte cluster

   Decorator might look something like:

   #+begin_src python
     @flyte(project='my project', domain='prototyping')
     class HelloFlow(FlowSpec):
         @step
         def start(self):
             print("HelloFlow is starting.")

             self.next(self.end)

         @step
         def end(self):
             """
             This is the 'end' step. All flows must have an 'end' step, which is the
             last step in the flow.

             """
             print("HelloFlow is all done.")
   #+end_src

   TODO: Do we want to separate [[https://docs.flyte.org/en/latest/concepts/registration.html][registration]] from execution? What does "submit"
   here mean?

   At some point in future, could even use [[https://docs.metaflow.org/going-to-production-with-metaflow/coordinating-larger-metaflow-projects#the-project-decorator][built-in @project]] decorator for
   this?? Metaflow branches seem analogous to Flyte domains.

   The fact that workflows can be authored as [[https://docs.flyte.org/en/latest/concepts/registration.html#typical-flow-without-flytekit][YAML, JSON, or protobuf]] -- that
   is, without using the =flytekit= Python SDK -- might be useful.

*** TODO Submit flow with only start/end w/ no external dependencies

*** TODO Submit flow with parameters

*** TODO Submit and execute flow

*** TODO Submit and set a schedule on a flow

    Could we use the Metaflow default [[https://docs.metaflow.org/going-to-production-with-metaflow/scheduling-metaflow-flows#scheduling-a-flow][@schedule]] decorator here? Or is that
    coupled to AWS Step?

** TODO Submit single step to Flyte cluster

** TODO [0/2] Reuse Metaflow default decorators for Flyte analogues

*** TODO [[https://docs.metaflow.org/metaflow/failures#retrying-tasks-with-the-retry-decorator][@retry]]

*** TODO [[https://docs.metaflow.org/metaflow/failures#timing-out-with-the-timeout-decorator][@timeout]]

* Out of Scope

  - Managing [[https://docs.flyte.org/en/latest/concepts/launchplans.html#divedeep-launchplans][launch plans]] associated w/ Metaflow flows
